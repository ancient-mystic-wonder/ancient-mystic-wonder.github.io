---
layout: post
title:  "Android Room Migration Strats"
date:   2018-06-26
categories: android
---

Note: I will be updating this post from time to time as I encounter more stuff related to migrations in Room

## Adding new columns (ALTER TABLE)

Situation:
We have a `User` object with fields `firstName` and `lastName`. We would like to add two new fields `email` and `nickName`. 

User.kt
{% highlight kotlin %}
@Entity(tableName = RoomContract.TABLE_PROFILE)
data class User(
    @PrimaryKey(autoGenerated = true)
    val id: Long,
    val firstName: String,
    val lastName: String,
    val email: String,
    val nickName: String
)
{% endhighlight %}

Migration code:
{% highlight kotlin %}
private val MIGRATION_1_2: Migration = object : Migration(1, 2) {
    override fun migrate(database: SupportSQLiteDatabase) {
        database.execSQL("ALTER TABLE User ADD COLUMN email TEXT NOT NULL DEFAULT ''")
        database.execSQL("ALTER TABLE User ADD COLUMN nickName TEXT NOT NULL DEFAULT ''")
    }
}
{% endhighlight %}

Explanation:

1) Two execSQL statements because SQLite can't handle multiple `ADD COLUMN ...` statements
<br />
2) `NOT NULL` because I declared the data type of both fields as `String`, not `String?`, which means they cannot be null
<br />
3) `DEFAULT ''` as a consequence from #2, we have to put a default value right away to the newly added column (not doing so will result in an error <error>)
